# 数据分区

MergeTree进行数据查询时，可以有效跳过无用的数据文件，只使用最小的分区目录子集。

* ClickHouse中，数据分区(partition)和数据分片(shard)是完全不同的概念。数据分区是针对本地数据而言，是对数据的一种纵向切分，MergeTree并不能依靠分区的特性，将一张表的数据分布到多个ClickHouse服务节点；
* 横向切分是数据分片(shard)的能力。

&nbsp;

## 数据分区规则

MergeTree数据分区规则由分区ID决定，具体到每个数据分区对应的ID， 由分区键的取值决定。分区键支持使用一个或者一组字段表达式声明，针对取值数据类型的不同，分区ID的生成逻辑有以下规则:

* **不指定分区键**：不设置分区键，分区ID默认取名`all`，所有数据都会被写入这个`all`分区。
* **整型**：分区键取值属于整型，且无法转换为日期类型(`YYYYMMDD`)格式，则直接按照整型的字符串形式输出，作为分区ID的取值。
* **日期**：如果分区键属于日期类型，或者能够转换为`YYYYMMDD`格式的整型，则使用 `YYYYMMDD` 进行格式化后字符串输出，并作为分区ID取值。
* **其他类型**： 如果分区键不属于整型、日期类型，例如`String`、`Float`类型等，则通过128位hash值作为分区ID的取值。

数据写入时，会按照分区ID落入相应的数据分区。如果通过元组的方式使用多个分区字段，格式如下：

```SQL
PARTITION BY (length(Code), EventTime)

# 生成如下格式

2-20190501
2-20190611
```

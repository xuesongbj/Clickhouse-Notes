# 二级索引

除了一级索引外，MergeTree同样支持二级索引。二级索引又称跳数索引，由数据的聚合信息构建而成。根据索引类型的不同，其聚合信息的内容也不同。跳数索引的目的与一级索引一样，也是帮助查询时减少扫描的范围。

跳数索引在默认情况下时关闭的，可设置 `ALLOW_EXPERIMENTAL_DATA_SKIPPING_INDICES=1` 进行开启。

**跳数索引**需要在`CREATE`语句内定义，它支持使用元组和表达式的形式声明。

```SQL
INDEX index_name expr TYPE index_type(...) GRANULARITY granularity
```

如果在建表语句中声明了跳数索引，会额外生成相应的索引与标记文件(`skp_idx_[Column].idx` 与 `skp_idx_[Column].mrk`)。

&nbsp;

## granularity 与 index_granularity 关系

`index_granularity` 定义了数据的粒度，而 `granularity` 定义了聚合信息汇总的粒度。也就是说 `granularity` 定义了一行跳数索引能够跳过多少个 `index_granularity` 区间的数据。

![granuraity](./granularity.png)

&nbsp;

## 跳数索引的类型

MergeTree共支持4种跳数索引: `minmax`、`set`、`ngrambf_v1`、`tokenbf_v1`。一张数据表可以同时支持多个跳数索引：

```SQL
create table skip_test (
    ID String,
    URL String,
    Code String,
    EventTime Date,
    INDEX a ID TYPE minmax GRANULARITY 5,
    INDEX b (length(ID) * 8) TYPE set(2) GRANURAITY 5,
    INDEX c (ID, Code) TYPE ngrambf_v1(3, 256, 2, 0) GRANURAITY 5,
    INDEX d ID TYPE tokenbf_v1(256, 2, 0) GRANURAITY 5
)
```

&nbsp;

### minmax

`minmax` 索引记录了一段数据内的最小值和最大值，索引的作用类似分区目录的minmax索引，能够快速跳过无用的数据区间。

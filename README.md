# Clickhouse-Notes

根据数据库处理的业务数据量和数据处理方式的不同，数据库分为OLTP(on-line transaction processing)和OLAP(On-Line Analytical Processing)两种。Clickhouse数据库由俄罗斯yandex搜索引擎公司开发并开源，最初定位于yandex内部的分析型数据库，符合OLAP数据库的实现特点。

&nbsp;

## OLTP Vs. OLAP

Oracle、MySQL等数据库都属于OLTP类型，即在线事务处理。 OLTP 数据库在处理请求和数据时需要高延迟，保证数据的完整性和一致性。这种数据库是面向终端用户的，需要7×24不间断的服务能力。

OLAP 的意思是在线分析数据处理。这种数据库需要存储海量但很少更新和修改的数据，主要用于多维历史数据分析和统计。对于这个需求，OLAP 数据库需要保证足够高的查询效率，至少 90% 的请求应该在短时间内返回。

另一方面，OLAP数据库并不直接面向最终客户，而是更注重数据吞吐量。它需要海量数据尽快持久化，为业务决策、战略定位与分析、个性化推荐等任务提供分析统计能力。因此，此类数据库中的查询一般是低频的。

&nbsp;

## ClickHouse主要特点

列存储是基于OLAP数据库的特点，ClickHouse采用列式数据存储引擎。传统的行数据库在存储信息时将信息--记录在数据库中。以用户注册信息为例，行数据库会依次记录每个用户的姓名、职业、年龄等数据。当业务需要查找注册用户的职业或年龄分布时，数据库需要打开所有存储用户注册信息的文件，遍历所有数据行，依次挑出所有的职业和年龄信息进行汇总。这样，查询遍历的数据往往远大于所需的数据大小，会造成IO容量的严重浪费。

相比之下，列存储会将数据分成多个属性列，比如用户注册信息分为职业、年龄等多个属性，并根据这些属性列分别存储在多个文件中。这样，当查询需要获取某些属性的数据时，只需要找到对应的文件即可完成，大大节省了IO需求。

以包含1亿条数据的测试为例，简单的count查询在MySQL上耗时两分钟多，而在列式Clickhouse数据库上返回结果只用了不到一秒。通过学习ClickHouse，可以了解具体设计思路，如何实现如此高效率的提升。
